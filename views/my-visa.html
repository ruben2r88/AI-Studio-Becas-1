<div class="card" data-visa-root="1">
  <div class="card-header">
    <ul class="nav nav-tabs card-header-tabs" id="visa-tabs" role="tablist">
      <li class="nav-item" role="presentation"><button class="nav-link active" id="visa-overview-tab" data-bs-toggle="tab" data-bs-target="#visa-overview" type="button" role="tab" aria-controls="visa-overview" aria-selected="true" data-tab="overview">Overview</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" id="visa-submission-tab" data-bs-toggle="tab" data-bs-target="#visa-submission" type="button" role="tab" aria-controls="visa-submission" aria-selected="false" data-tab="submission">Submission</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" id="visa-checklist-tab" data-bs-toggle="tab" data-bs-target="#visa-checklist" type="button" role="tab" aria-controls="visa-checklist" aria-selected="false" data-tab="checklist">Checklist</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" id="visa-appointment-tab" data-bs-toggle="tab" data-bs-target="#visa-appointment" type="button" role="tab" aria-controls="visa-appointment" aria-selected="false" data-tab="appointment">Appointment</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" id="visa-approval-tab" data-bs-toggle="tab" data-bs-target="#visa-approval" type="button" role="tab" aria-controls="visa-approval" aria-selected="false" data-tab="visa-approval">Visa Approval</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" id="visa-trip-tab" data-bs-toggle="tab" data-bs-target="#visa-trip" type="button" role="tab" aria-controls="visa-trip" aria-selected="false" data-tab="trip">Trip to Spain</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" id="visa-tie-tab" data-bs-toggle="tab" data-bs-target="#visa-tie" type="button" role="tab" aria-controls="visa-tie" aria-selected="false" data-tab="tie">TIE</button></li>
    </ul>
  </div>

  <div class="card-body tab-content" data-visa-root>
    <!-- === OVERVIEW === -->
    <div class="tab-pane fade show active" id="visa-overview" role="tabpanel" aria-labelledby="visa-overview-tab">
        <h5 class="fw-bold mb-2">MyVisa — Overview</h5>
        <div class="mb-3">
            <p class="text-muted">
                Processing your student visa is a crucial first step in your journey to Spain. 
                <button class="btn btn-link p-0 ms-1" data-bs-toggle="modal" data-bs-target="#visaOverviewModal">View more</button>
            </p>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="visaOverviewModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title fw-bold">Visa Overview — Full Info</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        <article class="visa-overview-full">
                          <p>Processing your student visa is a crucial first step in your journey to Spain and is essential for ensuring your timely arrival for your program. Staying focused and attentive to every detail will help ensure a smooth, hassle-free experience. This section, MyVisa, will guide you through the requirements and provide a clear visual organization of the steps necessary to successfully obtain your visa.</p>

                          <p>We have broken this process down into six sections:</p>
                          <ul>
                            <li><strong>Overview:</strong> Introduction to visa processing and MyVisa.</li>
                            <li><strong>Checklist:</strong> Upload all required documents for your visa application.</li>
                            <li><strong>Submission:</strong> Choose your visa submission location — either in the U.S. or Spain (restrictions apply).</li>
                            <li><strong>Appointment:</strong> Learn how to book your consulate appointment through BLS and confirm with ETURE staff.</li>
                            <li><strong>Visa Approval:</strong> Upload a photo of your visa once approved.</li>
                            <li><strong>TIE:</strong> Manage your appointment and obtain your Student Card in Spain.</li>
                          </ul>

                          <h6 class="mt-3">Important</h6>
                          <p>Unless otherwise instructed by ETURE staff, you will need to submit your visa application at the Spanish consulate in the U.S., depending on your state of residence. Spanish consulates collaborate with BLS, an external organization, to handle visa processing. For appointments and updates, frequently visit the BLS Spain Visa Service.</p>
                          <p>Review the Submission requirements for Spain in the Submission tab before proceeding.</p>
                          <p class="text-danger-emphasis"><em>Note:</em> If you plan to submit in Spain (last-minute), please review the restrictions and requirements in the <strong>Submission</strong> tab before proceeding (approval required, 30-day window from EU entry, and additional academic/legal fees).</p>

                          <h6 class="mt-3">The Role of GM Football Academy SL</h6>
                          <p>The ETURE student visa is processed through our academic partner, GM Football Academy, accredited by the Ministry of Education (Authorization Code: 46036402). They manage academic workload, Spanish classes, and football coaching lessons throughout the year. If asked during your consulate appointment, explain you will be studying at GM Football Academy.</p>

                          <h6 class="mt-3">Documents You Must Prepare</h6>
                          <ul>
                            <li>Visa Application Form</li>
                            <li>Original Passport (valid for program duration + 3 months)</li>
                            <li>ID – Proof of Jurisdiction</li>
                            <li>U.S. Immigration Status</li>
                            <li>Disclaimer Form</li>
                            <li>Two Passport Photos</li>
                            <li>Visa Consulate Fee &amp; BLS Fee</li>
                            <li>Medical Certificate</li>
                            <li>FBI Criminal Record Report + Apostille</li>
                            <li>Proof of Financial Means</li>
                            <li>Notarized Copy of Birth Certificate + Apostille</li>
                            <li>Translations (FBI Report, Apostille, Birth Certificate)</li>
                          </ul>

                          <h6 class="mt-3">Additional for Minors</h6>
                          <ul>
                            <li>Notarized Parental Authorization</li>
                            <li>Registry of Crimes of Sexual Nature authorization</li>
                            <li>Notarized copy of both parents' passports</li>
                            <li>ETURE Letter of Acceptance of Minor Responsibility</li>
                          </ul>

                          <h6 class="mt-3">Documents Provided by ETURE / GM Academy</h6>
                          <ul>
                            <li>ETURE Official Invitation Letter</li>
                            <li>GM Football Academy Acceptance Letter &amp; Certificate</li>
                            <li>Student Residence Letter</li>
                            <li>Letter of Financial Responsibility</li>
                            <li>Health Insurance Certificates (from DKV Insurance)</li>
                          </ul>

                          <h6 class="mt-3">Tips &amp; Next Steps</h6>
                          <ul>
                            <li>Start FBI checks early (valid for 180 days only).</li>
                            <li>Don’t book flights until your visa is approved.</li>
                            <li>Submit documents in person at the BLS center.</li>
                            <li>Upload all docs in Checklist for review by ETURE Admissions.</li>
                            <li>Schedule your consulate appointment via BLS website.</li>
                          </ul>
                        </article>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                    </div>
                </div>
            </div>
        <div class="visa-overview-summary">
            <!-- Paso actual + Progreso -->
            <div class="d-flex align-items-center justify-content-between mb-3">
                <div>
                <span class="me-2">Current step:</span>
                <span id="visa-ov-step" class="badge bg-primary">—</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                <div class="progress" style="width:200px;height:10px;">
                    <div id="visa-ov-progress" class="progress-bar bg-eture-red" style="width:0%"></div>
                </div>
                <small id="visa-ov-progress-text" class="text-muted">0% complete</small>
                </div>
            </div>

            <!-- Tarjetas por sección -->
            <div class="row g-3">

              <!-- Submission -->
              <div class="col-12 col-md-6 col-xl-4">
                <div class="card h-100">
                  <div class="card-body">
                    <h5 class="fw-bold mb-1">Submission</h5>
                    <p class="mb-3">Choose your BLS center and confirm submission.</p>
                    <a href="#visa-submission" class="stretched-link" data-visa-tab-target="#visa-submission">Go to Submission →</a>
                  </div>
                </div>
              </div>

              <!-- Checklist -->
              <div class="col-12 col-md-6 col-xl-4">
                <div class="card h-100">
                  <div class="card-body">
                    <h5 class="fw-bold mb-1">Checklist</h5>
                    <p class="mb-3">Upload all required documents for your visa application.</p>
                    <a href="#visa-checklist" class="stretched-link" data-visa-tab-target="#visa-checklist">Go to Checklist →</a>
                  </div>
                </div>
              </div>

              <!-- Appointment -->
              <div class="col-12 col-md-6 col-xl-4">
                <div class="card h-100">
                  <div class="card-body">
                    <h5 class="fw-bold mb-1">Appointment</h5>
                    <p class="mb-3">Book your consulate appointment via BLS.</p>
                    <a href="#visa-appointment" class="stretched-link" data-visa-tab-target="#visa-appointment">Go to Appointment →</a>
                  </div>
                </div>
              </div>

              <!-- Visa Approval -->
              <div class="col-12 col-md-6 col-xl-4">
                <div class="card h-100">
                  <div class="card-body">
                    <h5 class="fw-bold mb-1">Visa Approval</h5>
                    <p class="mb-3">Upload a photo of the visa page once approved.</p>
                    <a href="#visa-approval" class="stretched-link" data-visa-tab-target="#visa-approval">Go to Visa Approval →</a>
                  </div>
                </div>
              </div>

              <!-- Trip to Spain -->
              <div class="col-12 col-md-6 col-xl-4">
                <div class="card h-100">
                  <div class="card-body">
                    <h5 class="fw-bold mb-1">Trip to Spain</h5>
                    <p class="mb-3">Confirm your travel dates, arrival city and upload your itinerary.</p>
                    <a href="#visa-trip" class="stretched-link" data-visa-tab-target="#visa-trip">Go to Trip to Spain →</a>
                  </div>
                </div>
              </div>

              <!-- TIE -->
              <div class="col-12 col-md-6 col-xl-4">
                <div class="card h-100">
                  <div class="card-body">
                    <h5 class="fw-bold mb-1">TIE</h5>
                    <p class="mb-3">Manage your TIE appointment and upload the card.</p>
                    <a href="#visa-tie" class="stretched-link" data-visa-tab-target="#visa-tie">Go to TIE →</a>
                  </div>
                </div>
              </div>

            </div>

            <div class="mt-3">
                <small id="visa-ov-last-update" class="text-muted">Last update —</small>
            </div>
        </div>
    </div>

    <!-- 2) Submission -->
    <div class="tab-pane fade" id="visa-submission" role="tabpanel" aria-labelledby="visa-submission-tab">
      <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
        <div>
          <label class="form-label mb-0" for="submission-choice">Where will you submit your visa application?</label>
          <select id="submission-choice" class="form-select mt-1" aria-describedby="submission-choice-live">
            <option value="usa">USA</option>
            <option value="spain" data-disabled-for-minor="1" title="Minors must submit their visa application in the USA.">Spain (last-minute)</option>
          </select>
        </div>
        <div id="submission-progress" class="ms-auto" style="min-width: 200px;">
          <div class="progress" style="height: 6px;">
            <div id="submission-progress-bar" class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <small id="submission-progress-text" class="text-muted">0/0 verified</small>
        </div>
      </div>
      <div id="submission-choice-live" class="visually-hidden" aria-live="polite"></div>

      <div id="submission-usa-section">
        <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
          <div>
            <div id="my-visa-trip" aria-hidden="true"></div>
            <h5 class="fw-bold mb-1">Submit in USA</h5>
            <p class="mb-0 text-muted">Select the U.S. state where you live or where you are currently staying to get the correct submission location.</p>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label" for="submission-us-state">State or territory</label>
          <select id="submission-us-state" class="form-select">
          <option value="">Select a state…</option>
          <option value="AL">Alabama</option>
          <option value="AK">Alaska</option>
          <option value="AZ">Arizona</option>
          <option value="AR">Arkansas</option>
          <option value="CA">California</option>
          <option value="CO">Colorado</option>
          <option value="CT">Connecticut</option>
          <option value="DC">District of Columbia</option>
          <option value="DE">Delaware</option>
          <option value="FL">Florida</option>
          <option value="GA">Georgia</option>
          <option value="HI">Hawaii</option>
          <option value="ID">Idaho</option>
          <option value="IL">Illinois</option>
          <option value="IN">Indiana</option>
          <option value="IA">Iowa</option>
          <option value="KS">Kansas</option>
          <option value="KY">Kentucky</option>
          <option value="LA">Louisiana</option>
          <option value="ME">Maine</option>
          <option value="MD">Maryland</option>
          <option value="MA">Massachusetts</option>
          <option value="MI">Michigan</option>
          <option value="MN">Minnesota</option>
          <option value="MS">Mississippi</option>
          <option value="MO">Missouri</option>
          <option value="MT">Montana</option>
          <option value="NE">Nebraska</option>
          <option value="NV">Nevada</option>
          <option value="NH">New Hampshire</option>
          <option value="NJ">New Jersey</option>
          <option value="NM">New Mexico</option>
          <option value="NY">New York</option>
          <option value="NC">North Carolina</option>
          <option value="ND">North Dakota</option>
          <option value="OH">Ohio</option>
          <option value="OK">Oklahoma</option>
          <option value="OR">Oregon</option>
          <option value="PA">Pennsylvania</option>
          <option value="PR">Puerto Rico</option>
          <option value="RI">Rhode Island</option>
          <option value="SC">South Carolina</option>
          <option value="SD">South Dakota</option>
          <option value="TN">Tennessee</option>
          <option value="TX">Texas</option>
          <option value="UT">Utah</option>
          <option value="VT">Vermont</option>
          <option value="VA">Virginia</option>
          <option value="VI">U.S. Virgin Islands</option>
          <option value="WA">Washington</option>
          <option value="WV">West Virginia</option>
          <option value="WI">Wisconsin</option>
          <option value="WY">Wyoming</option>
        </select>
        </div>

        <div id="submission-ca-region-field" class="mb-3 d-none">
          <label class="form-label" for="submission-ca-region">California region</label>
          <select id="submission-ca-region" class="form-select">
            <option value="">Select a region…</option>
            <option value="north">Northern California (San Francisco)</option>
            <option value="south">Southern California (Los Angeles)</option>
          </select>
          <div class="form-text">Choose the region to match your BLS center.</div>
        </div>

        <div id="submission-consulate-card" class="mb-4">
          <div class="border rounded p-4 bg-light text-muted">Select a state to view your BLS submission location.</div>
        </div>

        <div class="card">
          <div class="card-body">
            <div class="row g-3 align-items-start">
              <div class="col-md-4 col-lg-3">
                <span class="text-muted small d-block">Status</span>
                <span id="submission-status" class="badge bg-secondary">Pending</span>
              </div>
              <div class="col-md-4 col-lg-3">
                <label class="form-label" for="visa-submission-date">Submission date</label>
                <input id="visa-submission-date" class="form-control" type="date">
              </div>
              <div class="col-md-8 col-lg-6">
                <label class="form-label" for="visa-submission-proof">Proof of submission</label>
                <div class="d-flex flex-wrap align-items-center gap-2">
                  <input id="visa-submission-proof" type="file" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                  <button id="submission-proof-replace" type="button" class="btn btn-sm btn-outline-secondary d-none">Replace</button>
                  <button id="submission-proof-view" type="button" class="btn btn-sm btn-outline-secondary d-none">View</button>
                </div>
                <div id="submission-proof-helper" class="form-text">Only PDF, JPG or PNG files.</div>
                <div id="submission-deny-alert" class="alert alert-danger small mt-2 d-none" role="alert"></div>
                <div id="submission-proof-meta" class="small text-muted mt-2"></div>
              </div>
            </div>

            <div id="submission-demo-actions" class="d-flex flex-wrap gap-2 mt-3 d-none">
              <button id="submission-verify-btn" type="button" class="btn btn-success btn-sm">Verify</button>
              <button id="submission-deny-btn" type="button" class="btn btn-danger btn-sm">Deny</button>
            </div>
          </div>
        </div>

        <div class="card mt-4">
          <div class="card-body">
            <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
              <h6 class="fw-bold mb-0">Checklist documents (read-only)</h6>
              <small class="text-muted">Mirrors everything from Checklist</small>
            </div>
            <div id="submission-usa-doc-list" class="list-group list-group-flush"></div>
            <div id="submission-usa-doc-empty" class="small text-muted">No documents available yet.</div>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mt-3">
          <small id="visa-submission-updated" class="text-muted">Last update —</small>
          <div id="submission-last-action" class="small text-muted"></div>
        </div>
      </div>

      <div class="modal fade" id="submission-deny-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Add denial reason</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label" for="submission-deny-reason">Reason shown to the student</label>
                <textarea id="submission-deny-reason" class="form-control" rows="3" placeholder="Provide a short reason" minlength="5" required></textarea>
              </div>
              <div class="small text-muted">Students will see this reason and can re-upload a new file.</div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" id="submission-deny-confirm" class="btn btn-danger">Deny</button>
            </div>
          </div>
        </div>
      </div>


      <div id="submission-spain-section" class="mt-5 d-none">
        <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3 position-relative">
          <div>
            <h5 class="fw-bold mb-1">Submitting Your Visa in Spain</h5>
            <p class="mb-0 text-muted">Visa submission in Spain is completed electronically and does not require an appointment. Our immigration attorney team manages the submission on your behalf. To ensure a successful process, it is important that you upload all required documents and complete the necessary steps in your country before traveling to Spain.</p>
          </div>
        </div>

        <div id="submission-spain-minor-hint" class="alert alert-info small d-none mb-4" role="alert">Minors must submit their visa application in the USA.</div>

        <div id="spain-restrictions-banner" class="alert alert-warning d-flex flex-wrap align-items-center justify-content-between gap-2 d-none" role="alert">
          <strong class="mb-0">Restrictions, Requirements, &amp; Fees</strong>
          <button id="spain-restrictions-viewmore" type="button" class="btn btn-sm btn-outline-secondary float-end">View more</button>
        </div>

        <div id="submission-spain-content" class="d-none">
          <div id="spain-approval-card" class="card mb-3">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-3 mb-3">
                <button id="spain-request-btn" class="btn btn-primary" type="button">Request</button>
                <div id="spain-request-status-pill" class="ms-auto"></div>
              </div>
              <div class="fw-semibold">Approval required</div>
              <small class="text-muted">Spain submission unlocks after staff approves your request.</small>
              <div id="submission-spain-request-status" class="small text-muted mt-2 d-none"></div>
              <div id="submission-spain-request-reason" class="small text-muted d-none"></div>
              <div id="submission-spain-request-actions" class="d-flex flex-wrap gap-2 justify-content-start justify-content-md-end mt-3"></div>
            </div>
            <div id="submission-spain-request-alert" class="alert alert-danger small d-none mb-0" role="alert"></div>
          </div>

          <div id="spain-eu-stays-block" hidden>
            <div id="submission-spain-eu-entries" class="card mb-4 d-none">
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label d-block" for="submission-spain-eu-visit-yes">Have you been in Europe in the last 6 months?</label>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="submission-spain-eu-visit" id="submission-spain-eu-visit-yes" value="yes">
                    <label class="form-check-label" for="submission-spain-eu-visit-yes">Yes</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="submission-spain-eu-visit" id="submission-spain-eu-visit-no" value="no">
                    <label class="form-check-label" for="submission-spain-eu-visit-no">No</label>
                  </div>
                </div>
              </div>

              <div id="submission-spain-stays-section" class="mt-3 d-none">
                <div class="table-responsive">
                  <table class="table table-sm align-middle mb-3">
                    <thead>
                      <tr>
                        <th scope="col">Country / Place</th>
                        <th scope="col">Date of Entry</th>
                        <th scope="col">Date of Exit</th>
                        <th scope="col" class="text-end">Actions</th>
                      </tr>
                    </thead>
                    <tbody id="submission-spain-stays-body"></tbody>
                  </table>
                </div>
                <button id="spain-add-stay-btn" type="button" class="btn btn-sm btn-outline-primary">+ Add another stay</button>
              </div>
            </div>
          </div>

          <div id="submission-spain-approved-row" class="d-none">
            <div class="row g-3 align-items-end">
              <div class="col-md-4">
                <label class="form-label" for="submission-spain-arrival-date">Expected Date of Arrival</label>
                <input id="submission-spain-arrival-date" type="date" class="form-control">
              </div>
            </div>

            <div class="card mt-3">
              <div class="card-body">
                <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
                  <h6 class="fw-bold mb-0">Spain required documents</h6>
                  <small class="text-muted">Managed from the Checklist tab</small>
                </div>
                <div id="submission-spain-doc-list" class="list-group list-group-flush"></div>
                <div id="submission-spain-doc-empty" class="text-muted small d-none">No Spain-specific documents configured.</div>
              </div>
            </div>
          </div>
        </div>
        <div id="submission-spain-request-live" class="visually-hidden" aria-live="polite"></div>
      </div>
      <div class="modal fade" id="spain-request-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Restrictions, Requirements, &amp; Fees</h5>
              <button id="spain-request-close" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p class="text-muted mb-2"><strong>Please read this carefully before submitting.</strong></p>
              <div id="spain-terms-text" class="small">
                <p>Applicants must be 18 years or older by the time of submission. Minors cannot submit the visa in Spain at this time.</p>
                <p>ETURE has a 30-day window from the date of your entry into the EU to complete the submission. Please provide information about your EU entries if you have been in Europe in the past 180 days.</p>
                <p>ETURE is not responsible for the outcome of the visa process. Approval is at the discretion of the administration. While most visas are approved, missing documents or incorrect information can lead to delays or denial.</p>
                <p>The administration has up to two legal months to resolve the application from the date of submission.</p>
                <p><strong>Fees: €2,400.00</strong>, which includes the additional academic fee through the University of Lleida and immigration attorney fees.</p>
              </div>
              <label class="form-label mt-2" for="spain-request-reason">Reason for submitting in Spain</label>
              <textarea id="spain-request-reason" class="form-control" minlength="10" placeholder="Explain why you need to submit in Spain..."></textarea>
              <div class="form-check mt-3">
                <input id="spain-terms-check" class="form-check-input" type="checkbox">
                <label for="spain-terms-check" class="form-check-label small">I have read and understand the restrictions, requirements and fees for VISA submission in Spain.</label>
              </div>
            </div>
            <div class="modal-footer">
              <button id="spain-request-cancel" type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button id="spain-request-submit" type="button" class="btn btn-primary" disabled>Submit request</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    </div>

    <!-- 3) Checklist -->

    <div class="tab-pane fade" id="visa-checklist" role="tabpanel" aria-labelledby="visa-checklist-tab">
      <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
        <h5 class="fw-bold mb-0">Checklist</h5>
        <div id="visa-checklist-progress" class="ms-auto small text-muted">0/0 verified</div>
      </div>
      <div id="visa-checklist-progress-wrap" class="progress">
        <div id="visa-checklist-progress-bar" class="progress-bar" role="progressbar" style="width:0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <small id="visa-verified-progress" class="visually-hidden">0/0 verified</small>
      <div class="row g-3" id="visa-checklist-section">
        <div class="col-lg-4 col-xl-3" id="visa-checklist-left">
          <div class="card h-100">
            <div class="card-body p-0">
              <div class="d-flex align-items-start justify-content-between p-3 border-bottom">
                <div>
                  <h6 class="fw-bold mb-1">Checklist</h6>
                  <small id="visa-demo-mode-note" class="text-muted d-none">Demo mode: review controls always visible</small>
                </div>
                <button id="visa-checklist-toggle" class="btn btn-sm btn-outline-secondary d-lg-none" type="button" aria-expanded="false" aria-controls="visa-checklist-list">Documents</button>
              </div>
              <div id="visa-checklist-list" class="list-group list-group-flush" role="tablist"><!-- items injected --></div>
            </div>
          </div>
        </div>
        <div class="col-lg-8 col-xl-9" id="visa-checklist-right">
          <div class="card" id="visa-doc-detail" tabindex="-1">
            <div class="card-body d-flex flex-column gap-3">
              <div id="visa-doc-header" class="d-flex align-items-start justify-content-between flex-wrap gap-2">
                <div>
                  <h5 id="visa-doc-title" class="fw-bold mb-1">Select a document</h5>
                  <span class="visa-doc-status badge bg-secondary">Pending</span>
                </div>
                <div class="d-flex flex-wrap justify-content-end align-items-center gap-3 ms-auto">
                  <button id="visa-portfolio-download" type="button" class="btn btn-sm btn-outline-primary" disabled>Download Portfolio</button>
                  <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" id="visa-checklist-minor-toggle">
                    <label class="form-check-label" for="visa-checklist-minor-toggle">I’m under 18</label>
                  </div>
                  <div style="min-width: 200px;">
                    <div class="progress" style="height: 6px;">
                      <div class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <small class="text-muted" data-role="visa-verified-progress-inline">0/0 verified</small>
                  </div>
                </div>
              </div>

              <div id="visa-portfolio-warning" class="alert alert-warning small d-none" role="alert"></div>

              <div id="visa-checklist-toast" class="alert alert-success py-2 px-3 small d-none" role="status"></div>

              <div id="doc-instructions-wrapper" class="bg-light rounded p-3">
                <div id="doc-instructions" class="small text-muted">Select a document on the left to view instructions.</div>
                <div class="d-flex flex-wrap justify-content-end gap-2 mt-2">
                  <button id="doc-instructions-more-btn" type="button" class="btn btn-sm btn-outline-secondary" disabled>View More</button>
                  <button id="doc-sample-btn" type="button" class="btn btn-sm btn-outline-primary" disabled aria-label="View sample document">Show Sample</button>
                </div>
              </div>

              <div id="visa-doc-upload">
                <label class="form-label" for="doc-file-input">Upload file</label>
                <div class="d-flex flex-wrap align-items-center gap-2">
                  <input id="doc-file-input" type="file" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                  <button id="doc-replace-btn" type="button" class="btn btn-sm btn-outline-secondary d-none" aria-label="Replace uploaded file">Replace</button>
                  <button id="doc-view-btn" type="button" class="btn btn-sm btn-outline-secondary" disabled aria-label="View uploaded file">View</button>
                </div>
                <div class="form-text">Only PDF, JPG or PNG files.</div>
                <div id="doc-upload-progress" class="small text-muted"></div>
              </div>

              <div id="doc-verified-message" class="alert alert-success small d-none" role="status"></div>

              <div id="doc-denial-alert" class="alert alert-danger small d-none" role="alert">
                <span id="doc-denial-reason"></span>
              </div>

              <div id="visa-doc-review-actions" class="d-flex flex-wrap align-items-center gap-2 d-none">
                <button id="btn-verify" type="button" class="btn btn-success btn-sm">Verify</button>
                <button id="btn-deny" type="button" class="btn btn-danger btn-sm">Deny</button>
              </div>

              <div>
                <label class="form-label" for="doc-notes">Notes</label>
                <textarea id="doc-notes" class="form-control" rows="3" placeholder="Optional notes..."></textarea>
              </div>

              <div id="eture-docs-detail" class="visa-detail" style="display: none;">
                <div class="d-flex align-items-center mb-2">
                  <div class="d-flex align-items-center">
                    <h4 class="mb-0">Eture Acceptance Letters</h4>
                    <small class="text-muted ms-2">Managed by Eture staff. Uploaded files appear below.</small>
                  </div>
                  <button id="eture-docs-download-portfolio" type="button" class="btn btn-sm btn-outline-primary ms-auto" disabled>Download Portfolio</button>
                </div>

                <div id="eture-upload-row" class="card card-body p-3 mb-3">
                  <div class="row g-2">
                    <div class="col-md-6">
                      <input id="eture-doc-name-input" class="form-control" placeholder="e.g., Acceptance Letter">
                    </div>
                    <div class="col-md-4">
                      <input id="eture-doc-file-input" type="file" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                    </div>
                    <div class="col-md-2 text-end">
                      <button id="eture-doc-upload-btn" class="btn btn-primary w-100">Upload</button>
                    </div>
                  </div>
                  <div id="eture-doc-error" class="text-danger small mt-2 d-none">Please provide a document name and select a file.</div>
                </div>

                <div id="eture-docs-list" class="list-group"></div>

                <div class="mt-2">
                  <small class="text-muted">Last update — <span id="eture-docs-last-update">—</span></small>
                </div>
              </div>

              <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                <small id="visa-checklist-updated" class="text-muted">Last update —</small>
                <div class="d-flex gap-2">
                  <button id="doc-prev-btn" type="button" class="btn btn-sm btn-outline-secondary" disabled>Previous</button>
                  <button id="doc-next-btn" type="button" class="btn btn-sm btn-outline-secondary" disabled>Next</button>
                </div>
              </div>
              <div class="small text-muted" data-role="visa-checklist-progress-detail"></div>
              <div id="visa-checklist-live-region" class="visually-hidden" aria-live="polite"></div>
              <div id="visa-portfolio-live" class="visually-hidden" aria-live="polite"></div>
            </div>
          </div>

        </div>
      </div>

      <div class="modal fade" id="denyModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Deny submission</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="denyReason" class="form-label">Reason for denial (shown to the student)</label>
                <textarea id="denyReason" class="form-control" rows="3" placeholder="Add your reason..." minlength="5" required></textarea>
              </div>
              <div class="text-muted small">Students will see this reason and can re-upload a new file.</div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" id="denySubmit" class="btn btn-danger">Deny</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="visa-doc-instructions-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="visa-doc-instructions-modal-title">Document instructions</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="visa-doc-instructions-modal-body"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- 4) Appointment -->
    <div class="tab-pane fade" id="visa-appointment" role="tabpanel" aria-labelledby="visa-appointment-tab">
      <div id="visa-appointment-section">
      <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
        <h5 class="fw-bold mb-0">Appointment</h5>
        <div id="visa-appointment-progress" class="ms-auto" style="min-width: 200px;">
          <div class="progress" style="height: 6px;">
            <div id="visa-appointment-progress-bar" class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <small id="visa-appointment-progress-text" class="text-muted">0/0 verified</small>
        </div>
      </div>
      <div id="visa-appointment-info" class="alert alert-info" role="alert">
        <strong>Bring to your appointment:</strong>
        <ul class="mb-0 ps-3">
          <li>Appointment confirmation</li>
          <li>Passport (original)</li>
          <li>Visa application packet and supporting documents</li>
          <li>Passport photo</li>
          <li>Proof of payment (consulate and BLS)</li>
        </ul>
      </div>
      <div id="visa-appointment-toast" class="alert alert-success small d-none" role="status"></div>
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="visa-appointment-read">
        <label class="form-check-label" for="visa-appointment-read">I confirm that I read this</label>
      </div>
      <div id="visa-appointment-warning" class="alert alert-warning d-none" role="alert"></div>
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label" for="visa-appointment-dt">Appointment Date &amp; Time</label>
          <input id="visa-appointment-dt" type="datetime-local" class="form-control" aria-describedby="visa-appointment-helper">
          <div id="visa-appointment-helper" class="form-text d-none">For Spain flow this is usually handled by ETURE staff. You may leave this blank.</div>
        </div>
        <div class="col-md-6">
          <label class="form-label d-block">Assigned BLS Center</label>
          <div id="visa-appointment-center-card" class="border rounded p-3 bg-light h-100">
            <h6 id="visa-appointment-center-city" class="fw-bold mb-1">Center not assigned</h6>
            <div id="visa-appointment-center-address" class="small text-muted"></div>
            <div id="visa-appointment-center-contact" class="small d-flex flex-column gap-1 mt-2">
              <div id="visa-appointment-center-phone" class="d-none"></div>
              <div id="visa-appointment-center-email" class="d-none"></div>
            </div>
            <div class="d-flex flex-wrap gap-2 mt-3">
              <a id="visa-appointment-center-website" class="btn btn-sm btn-outline-secondary d-none" href="#" target="_blank" rel="noopener">Visit Website</a>
              <a id="visa-appointment-center-maps" class="btn btn-sm btn-outline-secondary d-none" href="#" target="_blank" rel="noopener">Open in Google Maps</a>
            </div>
          </div>
        </div>
        <div class="col-12">
          <label class="form-label" for="visa-appointment-proof">Appointment Confirmation</label>
          <div class="d-flex flex-wrap align-items-center gap-2">
            <input id="visa-appointment-proof" type="file" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
            <button id="visa-appointment-view" type="button" class="btn btn-sm btn-outline-secondary d-none">View file</button>
          </div>
          <div id="visa-appointment-file-meta" class="small text-muted mt-2 d-none"></div>
        </div>
      </div>
      <div class="d-flex justify-content-center mt-4">
        <button id="visa-appointment-save-btn" class="btn btn-eture-red btn-lg fw-bold px-4" disabled>Save Appointment</button>
      </div>
      </div>
    </div>

    <!-- 5) Visa Approval -->
    <div class="tab-pane fade" id="visa-approval" role="tabpanel" aria-labelledby="visa-approval-tab">
      <div id="visa-approval-section">
      <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
        <h5 class="fw-bold mb-0">Visa Approval</h5>
        <div id="visa-approval-progress" class="ms-auto" style="min-width: 200px;">
          <div class="progress" style="height: 6px;">
            <div id="visa-approval-progress-bar" class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <small id="visa-approval-progress-text" class="text-muted">0/0 verified</small>
        </div>
      </div>
      <div class="alert alert-info text-muted" role="alert">
        Your initial visa is typically valid for 90 days—that’s normal. Once you obtain your TIE student card in Spain, it will cover the full duration of your program.
      </div>
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label" for="visa-approval-date">Approval Date</label>
          <input id="visa-approval-date" type="date" class="form-control">
        </div>
        <div class="col-md-8">
          <label class="form-label" for="visa-approval-scan">Upload Visa Page (Photo/Scan)</label>
          <div class="d-flex flex-wrap align-items-center gap-2">
            <input id="visa-approval-scan" type="file" class="form-control" accept=".jpg,.jpeg,.png,.pdf">
            <button id="visa-approval-view" type="button" class="btn btn-sm btn-outline-secondary d-none">View file</button>
          </div>
          <div class="form-text">Once your visa page is uploaded here, ETURE will proceed with booking your TIE appointment.</div>
          <div id="visa-approval-file-meta" class="small text-muted mt-2 d-none"></div>
        </div>
      </div>
      <div class="text-end mt-3">
        <button id="visa-approval-save-btn" class="btn btn-eture-red fw-bold">Save Approval</button>
      </div>
      </div>
    </div>

    <!-- 6) Trip to Spain -->
    <div id="visa-trip" class="tab-pane fade" role="tabpanel" aria-labelledby="visa-trip-tab" aria-hidden="true">
      <h5 class="fw-bold mb-3">Trip to Spain</h5>

      <div class="row g-3">
        <div class="col-md-4">
          <label for="trip-departure-date" class="form-label">Departure date</label>
          <input id="trip-departure-date" class="form-control" type="date" />
        </div>
        <div class="col-md-4">
          <label for="trip-arrival-date" class="form-label">Arrival date</label>
          <input id="trip-arrival-date" class="form-control" type="date" />
        </div>
        <div class="col-md-4">
          <label for="trip-arrival-time" class="form-label">Arrival time (local)</label>
          <input id="trip-arrival-time" class="form-control" type="time" />
        </div>
        <div class="col-md-4">
          <label for="trip-arrival-place" class="form-label">Arrival city / airport</label>
          <input id="trip-arrival-place" class="form-control" type="text" placeholder="e.g., Madrid (MAD)"/>
        </div>

        <div class="col-12">
          <label for="trip-itinerary-file" class="form-label">Travel itinerary (PDF/JPG/PNG)</label>
          <input id="trip-itinerary-file" class="form-control" type="file" accept=".pdf,.jpg,.jpeg,.png" />
          <div class="form-text">Upload your flight booking so staff can track your arrival.</div>
          <a id="trip-itinerary-link" class="small d-none" target="_blank" rel="noopener">View uploaded itinerary</a>
        </div>

        <div class="col-12">
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" id="trip-read-confirm" />
            <label class="form-check-label" for="trip-read-confirm">
              I confirm these travel details are correct.
            </label>
          </div>
        </div>

        <div class="col-12 d-flex gap-2 mt-2">
          <button id="trip-save-btn" class="btn btn-primary">Save Trip</button>
          <span id="trip-save-status" class="text-muted small"></span>
        </div>

        <hr class="my-3"/>

        <div class="col-12">
          <div class="alert alert-info mb-0">
            <div class="fw-semibold mb-1">When does this tab unlock?</div>
            <ul class="mb-0">
              <li><strong>Spain route:</strong> unlocks when FBI Background Check AND Apostille are uploaded/verified.</li>
              <li><strong>USA route:</strong> unlocks after Visa Approval is uploaded.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- 7) TIE -->
    <div class="tab-pane fade" id="visa-tie" role="tabpanel" aria-labelledby="visa-tie-tab">
      <div id="tie-section">
      <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
        <div>
          <h5 class="fw-bold mb-1">TIE (Spain, Valencia)</h5>
          <p class="text-muted small mb-0">ETURE staff normally book this appointment. This form is editable here for testing. In production it will be read-only for students.</p>
        </div>
        <div id="visa-tie-progress" class="ms-auto" style="min-width: 200px;">
          <div class="progress" style="height: 6px;">
            <div id="visa-tie-progress-bar" class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <small id="visa-tie-progress-text" class="text-muted">0/0 verified</small>
        </div>
      </div>
      <div id="visa-tie-visa-indicator" class="text-success small mb-2 d-none">Visa uploaded ✓</div>
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label" for="tie-appointment-date">Appointment Date</label>
          <input id="tie-appointment-date" type="date" class="form-control">
        </div>
        <div class="col-md-6">
          <label class="form-label" for="tie-office">Police Station / Office</label>
          <input id="tie-office" class="form-control" placeholder="Comisaría / Oficina">
        </div>
        <div class="col-12">
          <label class="form-label" for="tie-proof">Upload TIE / Resguardo</label>
          <div class="d-flex flex-wrap align-items-center gap-2">
            <input id="tie-proof" type="file" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
            <button id="tie-proof-view" type="button" class="btn btn-sm btn-outline-secondary d-none">View file</button>
          </div>
          <div id="tie-proof-meta" class="small text-muted mt-2 d-none"></div>
        </div>
      </div>
      <div class="text-end mt-3">
        <button id="visa-tie-save-btn" class="btn btn-eture-red fw-bold">Save TIE</button>
      </div>
      </div>
    </div>
  </div>
</div>
