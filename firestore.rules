rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function signedIn() {
      return request.auth != null;
    }

    // Dueño del recurso
    function isOwner(userId) {
      return signedIn() && request.auth.uid == userId;
    }

    /* 
      PERFIL DEL USUARIO
      Cubrimos dos variantes por si tu código guarda en /users/{uid}
      o en /profiles/{uid}. También cubrimos subcolecciones debajo.
    */

    // Opción 1: doc de perfil en /users/{uid}
    match /users/{userId} {
      allow read, write: if isOwner(userId);

      // Cualquier subruta bajo /users/{uid}/... (por ejemplo /users/{uid}/forms/...)
      match /{document=**} {
        allow read, write: if isOwner(userId);
      }
    }

    // Opción 2: doc de perfil en /profiles/{uid}
    match /profiles/{userId} {
      allow read, write: if isOwner(userId);

      match /{document=**} {
        allow read, write: if isOwner(userId);
      }
    }
  }
}
